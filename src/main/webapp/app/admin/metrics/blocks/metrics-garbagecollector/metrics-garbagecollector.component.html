<!--
  ~ Copyright (c) 2021. The Hyve
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  -->

<h3 [translate]="'metrics.jvm.gc.title'" id="garbageCollectorMetrics">Garbage collector statistics</h3>

<div class="row">
    <div class="col-md-4">
        <div *ngIf="garbageCollectorMetrics">
      <span>
        GC Live Data Size/GC Max Data Size ({{ garbageCollectorMetrics['jvm.gc.live.data.size'] / 1048576 | number: '1.0-0' }}
          M /
          {{ garbageCollectorMetrics['jvm.gc.max.data.size'] / 1048576 | number: '1.0-0' }}M)
      </span>

            <ngb-progressbar
                    [animated]="false"
                    [max]="garbageCollectorMetrics['jvm.gc.max.data.size']"
                    [striped]="true"
                    [value]="garbageCollectorMetrics['jvm.gc.live.data.size']"
                    type="success"
            >
        <span>
          {{
                (100 * garbageCollectorMetrics['jvm.gc.live.data.size']) / garbageCollectorMetrics['jvm.gc.max.data.size'] | number: '1.0-2'
            }}%
        </span>
            </ngb-progressbar>
        </div>
    </div>

    <div class="col-md-4">
        <div *ngIf="garbageCollectorMetrics">
      <span>
        GC Memory Promoted/GC Memory Allocated ({{ garbageCollectorMetrics['jvm.gc.memory.promoted'] / 1048576 | number: '1.0-0' }}
          M /
          {{ garbageCollectorMetrics['jvm.gc.memory.allocated'] / 1048576 | number: '1.0-0' }}M)
      </span>

            <ngb-progressbar
                    [animated]="false"
                    [max]="garbageCollectorMetrics['jvm.gc.memory.allocated']"
                    [striped]="true"
                    [value]="garbageCollectorMetrics['jvm.gc.memory.promoted']"
                    type="success"
            >
        <span>
          {{
                (100 * garbageCollectorMetrics['jvm.gc.memory.promoted']) / garbageCollectorMetrics['jvm.gc.memory.allocated']
                        | number: '1.0-2'
            }}%
        </span>
            </ngb-progressbar>
        </div>
    </div>

    <div class="col-md-4" id="garbageCollectorMetrics">
        <div *ngIf="garbageCollectorMetrics" class="row">
            <div class="col-md-9">Classes loaded</div>
            <div class="col-md-3 text-right">{{ garbageCollectorMetrics.classesLoaded }}</div>
        </div>
        <div *ngIf="garbageCollectorMetrics" class="row">
            <div class="col-md-9">Classes unloaded</div>
            <div class="col-md-3 text-right">{{ garbageCollectorMetrics.classesUnloaded }}</div>
        </div>
    </div>

    <div *ngIf="!updating && garbageCollectorMetrics" class="table-responsive">
        <table aria-describedby="garbageCollectorMetrics" class="table table-striped">
            <thead>
            <tr>
                <th scope="col"></th>
                <th [translate]="'metrics.servicesstats.table.count'" class="text-right" scope="col">Count</th>
                <th [translate]="'metrics.servicesstats.table.mean'" class="text-right" scope="col">Mean</th>
                <th [translate]="'metrics.servicesstats.table.min'" class="text-right" scope="col">Min</th>
                <th [translate]="'metrics.servicesstats.table.p50'" class="text-right" scope="col">p50</th>
                <th [translate]="'metrics.servicesstats.table.p75'" class="text-right" scope="col">p75</th>
                <th [translate]="'metrics.servicesstats.table.p95'" class="text-right" scope="col">p95</th>
                <th [translate]="'metrics.servicesstats.table.p99'" class="text-right" scope="col">p99</th>
                <th [translate]="'metrics.servicesstats.table.max'" class="text-right" scope="col">Max</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>jvm.gc.pause</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause'].count }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause'].mean | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause']['0.0'] | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause']['0.5'] | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause']['0.75'] | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause']['0.95'] | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause']['0.99'] | number: '1.0-3' }}</td>
                <td class="text-right">{{ garbageCollectorMetrics['jvm.gc.pause'].max | number: '1.0-3' }}</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
