<!--
  ~ Copyright (c) 2021. The Hyve
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~
  ~ See the file LICENSE in the root of this repository.
  -->

<div class="modal-header">
    <h4 [translate]="'metrics.jvm.threads.dump.title'" class="modal-title">Threads dump</h4>

    <button (click)="dismiss()" class="close" type="button">&times;</button>
</div>

<div class="modal-body">
    <div class="mb-3">
    <span (click)="threadStateFilter = undefined" class="badge badge-primary hand">
      <fa-icon *ngIf="threadStateFilter === undefined" icon="check"></fa-icon>
      All&nbsp;<span class="badge badge-pill badge-default">{{ threadDumpAll }}</span>
    </span>

        <span (click)="threadStateFilter = ThreadState.Runnable" class="badge badge-success hand">
      <fa-icon *ngIf="threadStateFilter === ThreadState.Runnable" icon="check"></fa-icon>
      Runnable&nbsp;<span class="badge badge-pill badge-default">{{ threadDumpRunnable }}</span>
    </span>

        <span (click)="threadStateFilter = ThreadState.Waiting" class="badge badge-info hand">
      <fa-icon *ngIf="threadStateFilter === ThreadState.Waiting" icon="check"></fa-icon>
      Waiting&nbsp;<span class="badge badge-pill badge-default">{{ threadDumpWaiting }}</span>
    </span>

        <span (click)="threadStateFilter = ThreadState.TimedWaiting" class="badge badge-warning hand">
      <fa-icon *ngIf="threadStateFilter === ThreadState.TimedWaiting" icon="check"></fa-icon>
      Timed Waiting&nbsp;<span class="badge badge-pill badge-default">{{ threadDumpTimedWaiting }}</span>
    </span>

        <span (click)="threadStateFilter = ThreadState.Blocked" class="badge badge-danger hand">
      <fa-icon *ngIf="threadStateFilter === ThreadState.Blocked" icon="check"></fa-icon>
      Blocked&nbsp;<span class="badge badge-pill badge-default">{{ threadDumpBlocked }}</span>
    </span>
    </div>

    <div *ngFor="let thread of getThreads()" class="pad">
        <h6>
            <span [ngClass]="getBadgeClass(thread.threadState)" class="badge">{{ thread.threadState }}</span>

            &nbsp;{{ thread.threadName }} (ID {{ thread.threadId }})

            <a (click)="thread.showThreadDump = !thread.showThreadDump" href="javascript:void(0);">
                <span [hidden]="thread.showThreadDump"
                      [translate]="'metrics.jvm.threads.dump.show'">Show StackTrace</span>
                <span [hidden]="!thread.showThreadDump"
                      [translate]="'metrics.jvm.threads.dump.hide'">Hide StackTrace</span>
            </a>
        </h6>

        <div [hidden]="!thread.showThreadDump" class="card">
            <div class="card-body">
                <div *ngFor="let st of thread.stackTrace" class="break">
                    <samp>{{ st.className }}.{{ st.methodName }}(<code>{{ st.fileName }}
                        :{{ st.lineNumber }}</code>)</samp>
                    <span class="mt-1"></span>
                </div>
            </div>
        </div>
        <table class="table table-sm table-responsive">
            <caption>Threads dump: {{ thread.threadName }}</caption>
            <thead>
            <tr>
                <th [translate]="'metrics.jvm.threads.dump.blockedtime'" scope="col">Blocked Time</th>
                <th [translate]="'metrics.jvm.threads.dump.blockedcount'" scope="col">Blocked Count</th>
                <th [translate]="'metrics.jvm.threads.dump.waitedtime'" scope="col">Waited Time</th>
                <th [translate]="'metrics.jvm.threads.dump.waitedcount'" scope="col">Waited Count</th>
                <th [translate]="'metrics.jvm.threads.dump.lockname'" scope="col">Lock Name</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{{ thread.blockedTime }}</td>
                <td>{{ thread.blockedCount }}</td>
                <td>{{ thread.waitedTime }}</td>
                <td>{{ thread.waitedCount }}</td>
                <td class="thread-dump-modal-lock" title="{{ thread.lockName }}">
                    <code>{{ thread.lockName }}</code>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="modal-footer">
    <button (click)="dismiss()" class="btn btn-secondary float-left" data-dismiss="modal" type="button">Done</button>
</div>
